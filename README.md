# MyTracks KML Helper

Takes a bunch of KML files generated by MyTracks and merges them into
one.

This is a really janky, hacky script, but it does the job.


## Updating the merged file with new tracks from the phone

1. In My Tracks, in the list of tracks, sync to GDrive.
1. Download the GDrive `mytracks` folder.
    1. Upload all new/original track files (so, non-merged, etc) to `mytracks_original`, to keep a backup
1. Copy the downloaded `mytracks` folder to this repo's `mytracks` 
1. Manipulate any files you may need to manipulate. (see section below)
    - Use the visualizers below, plus this script's CLI arguments to generate the file you actually want.
    - Read the code of `merge_all()` to understand what kind of things need to happen to a file you touch. 
    - If you manually manipulate a track, upload it to `mytracks_original` with suffix `-fixed`
    - If you'd originally renamed the track to call attention to it, rename it back to the standard Date 
      format in `mytracks_original`.
    - Leave the manipulated file in `mytracks`, with the correct track name (with date in it) so it'll be
      picked up in order and its date parsed on the merge step.

1. `ruby merge.rb` to merge all the files in the `mytracks` folder into a new one.
    - Maybe include the previous merged, maybe not... You may end up with enormous files... 
1. take the `merged*.kml` file


## On the phone

- Go to Google Drive, select the file, and then "Copy to" (not "Download"). I don't know why...


## Manipulating the individual tracks to merge

All of these are commands are run with `ruby merge.rb command [options]`, act on one single file specified with
the `-f` parameter, and generate an `output.kml` in the root directory with the results.

- Slice a file: Reduce the route in a file to only points that fall between the two specified timestamps
    - `ruby merge.rb slice -f "mytracks/Route from 2020-07-23 11_39.kml" --from "2020-07-23 13:14:47" --to "2020-07-23 14:00:10"` 
- Split a file: Split a route into two, with the points before/after the `--at` parameters. Outputs `output_before.kml`
  and `output_after.kml`.
    - `ruby merge.rb split -f "mytracks/Route from 2020-07-23 11_39.kml" --at "2020-07-23 14:00:10"` 

## Utilities

- [Online KML Viewer](http://kmlviewer.nsspot.net/): Useful to just see a route
- [Another Online KML Viewer](https://www.gpsvisualizer.com/): Useful to see individual points
    - Go into "advanced leaflet options"
    - Enter "1 min" into `Tickmark interval`